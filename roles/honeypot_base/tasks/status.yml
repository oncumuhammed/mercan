---
# =========================================================================
# Honeypot Base Role - Status Check
# =========================================================================
# Checks the status of a honeypot deployment

- name: Check if systemd service exists
  stat:
    path: "/etc/systemd/system/{{ honeypot_service_name }}.service"
  register: service_file

- name: Check systemd service status
  command: systemctl status {{ honeypot_service_name }}
  register: service_status
  changed_when: false
  failed_when: false
  when: service_file.stat.exists

- name: Check Docker Compose status
  command: docker compose ps
  args:
    chdir: "{{ honeypot_compose_dir }}"
  register: compose_status
  changed_when: false
  failed_when: false

- name: Display honeypot status
  debug:
    msg:
      - "Honeypot: {{ honeypot_name }}"
      - "Service file exists: {{ service_file.stat.exists }}"
      - "Service status: {{ 'Running' if service_status.rc == 0 else 'Stopped' }}"
      - "Docker containers: {{ compose_status.stdout_lines | default([]) }}"
